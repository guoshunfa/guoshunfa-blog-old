---
title: Kafka 介绍
date: 2021-10-27 14:18:31
permalink: /pages/ae56b2/
tags: 
  - null
categories: 
  - 部署
  - 服务
  - Kafka
---

# Kafka 介绍

## 1. Kafka 服务安装

### 1.1. 下载kafka服务包

```sh
wget https://archive.apache.org/dist/kafka/0.10.2.1/kafka_2.10-0.10.2.1.tgz
```

### 1.2. 解压

```sh
tar -zxvf kafka_2.10-0.10.2.1.tgz
```

### 1.3. 进入kafka目录

```sh
cd kafka_2.10-0.10.2.1
```

### 1.4. 修改配置文件server.properties

```properties
broker.id=0
# ip可以是公网ip
advertised.listeners=PLAINTEXT://ip:9092
# ip最好使用内网ip，否则会出现错误：Socket server failed to bind to ip:9092: 无法指定被请求的地址
listeners=PLAINTEXT://ip:9092
num.network.threads=3
num.io.threads=8
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
log.dirs=/pandas/service/log/kafka
num.partitions=1
num.recovery.threads.per.data.dir=1
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000

############################# Zookeeper #############################
# 最好使用内网ip，否则会出现错误：Socket server failed to bind to ip:9092: 无法指定被请求的地址
zookeeper.connect=ip:2181
zookeeper.connection.timeout.ms=6000
```

### 1.5. 编写启动脚本

```sh
vi kafkastart.sh
```

```sh
#启动zookeeper
/<kafka目录>/bin/zookeeper-server-start.sh /<kafka目录>/config/zookeeper.properties &
#等3秒后执行
sleep 3 
#启动kafka
/<kafka目录>/bin/kafka-server-start.sh /<kafka目录>/config/server.properties &
```

### 1.6. 编写关闭脚本

```sh
vi kafkastop.sh
```

```sh
#关闭zookeeper
/<kafka目录>/bin/zookeeper-server-stop.sh /<kafka目录>/config/zookeeper.properties &
#等3秒后执行
sleep 3 
#关闭kafka
/<kafka目录>/bin/kafka-server-stop.sh /<kafka目录>/config/server.properties &
```

1.7. 启动脚本，关闭脚本赋予权限

```sh
chmod 777 kafkastart.sh
```

```sh
chmod 777 kafkastop.sh
```

## 2. 可视化管理页面安装

kafka官网地址：https://github.com/linkedin/kafka-monitor，运行比较简单，只是一个可执行jar（KafkaOffsetMonitor-assembly-0.2.1.jar）。

### 2.1 编写启动脚本

```sh
java -Xms128M -Xmx128M -Xss1024K -XX:PermSize=128m -XX:MaxPermSize=128m -cp KafkaOffsetMonitor-assembly-0.2.1.jar com.quantifind.kafka.offsetapp.OffsetGetterWeb --zk localhost:2181 --port 8787 --refresh 10.seconds --retain 7.days 1>/usr/local/software/kafka-monitor/stdout.log 2>/usr/local/software/kafka-monitor/stderr.log &
```

