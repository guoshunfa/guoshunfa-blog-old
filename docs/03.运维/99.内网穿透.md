---
tags: 
  - 内网穿透
title: 内网穿透
permalink: /pages/6b6520/
date: 2021-08-29 01:39:10
author: 
  name: 熊猫 code
  link: https://pandacode.cn
categories: 
  - 运维
---
# 内网穿透

> 外网 访问内网服务器。

## frp（提供软件服务）

> 通过在具有公网 IP 的节点上部署 frp 服务端，可以轻松地将内网服务穿透到公网，同时提供诸多专业的功能特性，这包括：
>
> - 客户端服务端通信支持 TCP、KCP 以及 Websocket 等多种协议。
> - 采用 TCP 连接流式复用，在单个连接间承载更多请求，节省连接建立时间。
> - 代理组间的负载均衡。
> - 端口复用，多个服务通过同一个服务端端口暴露。
> - 多个原生支持的客户端插件（静态文件查看，HTTP、SOCK5 代理等），便于独立使用 frp 客户端完成某些工作。
> - 高度扩展性的服务端插件系统，方便结合自身需求进行功能扩展。
> - 服务端和客户端 UI 页面。
>
> [frp github](https://github.com/fatedier/frp/tree/master) | [bilibili 视频教程](https://www.bilibili.com/video/BV1J74117714?from=search&seid=15603148927849452138) | [frp中文文档](https://gofrp.org/docs/) | [frp下载地址](https://github.com/fatedier/frp/releases) | [官方示例](https://gofrp.org/docs/examples/ssh/)

### 第一步：阅读frp中文文档

移步到官网 -> [frp中文文档](https://gofrp.org/docs/)

frp需要配置两端，客户端和服务端，服务端是具有公网ip的服务器，客户端是内网中的服务器。

### 第二步：下载

[frp下载地址](https://github.com/fatedier/frp/releases)

根据操作系统选择对应的版本。

### 第三步：配置 服务端和客户端

> 目录介绍：frpc前缀的文件是内网服务需要的；frps前缀的文件是公网IP需要的。

可以查看官网[示例](https://gofrp.org/docs/examples/ssh/)，这里也简单的做一些介绍。

#### **公网服务需要配置`frps.ini`文件**

```ini
[common]
bind_port = 7000
```

bind_port表示frp服务对应端口，后续需要在内网服务器对应frpc.ini文件也对应上。

#### **内网服务需要配置`frpc.ini`文件**

> **按需求进行配置信息**，除基础信息配置common外，其他的根据自己需求进行摘选（每一个标签都是一个独立的模块）。

```ini
[common]
server_addr = pandacode.cn 
server_port = 7000

[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

`server_addr`表示公网服务器的IP/域名，server_port表示对应公网frp服务的端口。

##### `ssh`

> [通过 SSH 访问内网机器](https://gofrp.org/docs/examples/ssh/)

```ini
[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

type表示对应类型，`local_ip` 和 `local_port` 配置为本地需要暴露到公网的服务地址和端口。`remote_port` 表示在 frp 服务端监听的端口，访问此端口的流量将会被转发到本地服务对应的端口。

### 第四步：frp服务启动

先通过 `./frps -c ./frps.ini` 启动服务端，再通过 `./frpc -c ./frpc.ini` 启动客户端。如果需要在后台长期运行，建议结合其他工具使用，例如 `systemd` 和 `supervisor`。

##### `systemd` 和 `supervisor`例子

编辑systemd配置文件：

`vim /usr/lib/systemd/system/frp.service`

```
[Unit]

Description = FRP to bypass NAT Network

Wants = network-online.target

After = network.target

[Service]

Type = simple

ExecStart = /bin/frpc -c /etc/frp.ini

#此处需按实际情况修改为frp二进制文件目录和manuscript.from.cmdgy.com配置文件目录

StandardOutput = syslog

StandardError = inherit

[Install]

WantedBy = multi-user.target
```

**ExecStart为启动命令**

接下来即可像启停nginx一样，使用systemd命令来操作frp服务：

```shell
systemctl enable frp

systemctl start frp
```

## Ngrok（提供线上隧道和线上管理平台）

### 第一步：注册/登陆Ngork

[点击进入Ngrok官网](http://ngrok.cc/login.html)

### 第二步：购买隧道（有免费的）

![image-20210718150645562](https://cdn.jsdelivr.net/gh/guoshunfa/files/blog/202109101831106.png)

**配置相关信息**

### 第三步：下载/使用Ngork客户端

> 不同系统，使用不同，详情需要查看官方文档。

Mac 版本

```shell
./sunny clientid 隧道id
```

![image-20210718151318687](https://file.pandacode.cn/blog/202109091332141.png)

