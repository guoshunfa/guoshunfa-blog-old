---
title: React 组件之间通讯
date: 2022-02-03 00:58:52
permalink: /pages/9a68e5/
categories:
  - 前端
  - 前端框架
  - React
tags:
  - React
---

# React 组件之间通讯

React 父子组件、兄弟组件、叔侄应该如何进行通讯，这里描述一下两种方法。

**props function**

缺点：

1. 操作繁琐，组件关系越复杂代码量越多。
2. 耦合性太强。

**消息 订阅与发布**

优点：

1. 只需在指定的位置进行订阅消息、发布消息即可。
2. 极大程度上降低耦合性。

## 1. 通过props function进行通讯

**原理：**

找到父子、兄弟、叔侄组件的共同组件，绑定props function，进行通讯。

```jsx
// 父组件 App.jsx
import React, { Component } from 'react';
import List from './compoments/List';
import Search from './compoments/Search';

export default class App extends Component {
  state = {datas:[]}
  dataChange = (datas)=>{
    this.setState({datas: datas})
  }
  render() {
    return <div>
      <Search dataChange={this.dataChange} />
      <List datas={this.datas} />
    </div>
  }
}

```

```jsx
// 子组件 List.jax
import React, { Component } from 'react';

export default class List extends Component {
  render() {
    return <div>
      {
        this.props.datas.map(data=>{
          return <span key={data.id}>{data.name}</span>
        })
      }
    </div>
  }
}
```

```jsx
// 子组件 Search.jsx
import React, { Component } from 'react';

export default class Search extends Component {
  dataChange=()=>{
    this.props.dataChange([{/** 省略数据 */}]);
  }
  render() {
    return <div>
      <button onClick={this.dataChange}>我点</button>
    </div>
  }
}
```

> 通过function dataChange进行通信。
>
> 操作繁琐，本应跟App.jsx无关的操作，现在代码放到了App.jsx中。

## 2.消息 订阅与发布

> 接着使用上面的例子。通过比较可以直接看出优缺点。

```jsx
// 父组件 App.jsx
import React, { Component } from 'react';
import List from './compoments/List';
import Search from './compoments/Search';

export default class App extends Component {
  render() {
    return <div>
      <Search />
      <List />
    </div>
  }
}
```

```jsx
// 子组件 List.jax
import React, { Component } from 'react';

export default class List extends Component {
  state={datas:[]}
  
  //组件挂载完毕的钩子
  componentDidMount(){
    this.dataChangeToken = PubSub.subscribe("dataChange", (msg, data) => {
      this.setState({ datas: data });
    });
  }

  //组件将要卸载的钩子
  componentWillUnmount(){
    PubSub.unsubscribe(this.dataChangeToken);
  }
  render() {
    return <div>
      {
        this.state.datas.map(data=>{
          return <span key={data.id}>{data.name}</span>
        })
      }
    </div>
  }
}
```

```jsx
// 子组件 Search.jsx
import React, { Component } from 'react';

export default class Search extends Component {
  dataChange=()=>{
    // 发布消息
    PubSub.publish("dataChange", [{/** 省略数据 */}]);
  }
  
  render() {
    return <div>
      <button onClick={this.dataChange}>我点</button>
    </div>
  }
}
```

1. 兄弟组件之间通讯直接通过发布、订阅消息，使得父组件App.jsx只需要管理组件摆放位置即可。
2. 这里用到的消息发布订阅的组件包是[PubSubJS](/pages/c31095/)。
3. token的管理不能像本文中直接使用字符串，需要设定一个TOKEN工厂来统一进行管理。
